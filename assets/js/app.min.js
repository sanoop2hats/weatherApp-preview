// declaration elements
let errorMsg = document.querySelector('.error-msg');
let Currenttemp = document.querySelector('.Ctemp');
let description = document.querySelector('.description');
let weatherIcon = document.querySelector('.weather-set-icon');
let humidity = document.querySelector('.humidity');
let wind = document.querySelector('.wind');
let city = document.querySelector('.current-location');
let highTemp = document.querySelector('.high-temp');
let lowTemp = document.querySelector('.low-temp');
let dateEl = document.querySelector('.current-date');
let days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday']
let months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
let currentDate = new Date();
let month = currentDate.getMonth();
let date = currentDate.getDate();
let day = currentDate.getDay();
// ends

// current date 
dateEl.innerHTML = days[day] + ', ' + date + ' ' + months[month]
// end

const key = "82005d27a116c2880c8f0fcb866998a0" // API key


// Geolocation 
getLocation()
function getLocation() {
    if ('geolocation' in navigator) {
        navigator.geolocation.getCurrentPosition(showPosition);
    } else {
        errorMsg.innerHTML = "Geolocation is not supported by this browser.";
    }
}
// success function Geolocation
function showPosition(position) {
    let latitude = position.coords.latitude;
    let longitude = position.coords.longitude;
    getWeather(latitude, longitude);
}
// end
function getWeather(latitude, longitude) {
    let api = `http://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&appid=${key}`; //API  call
    fetch(api)
        .then(function (response) {
            let data = response.json();
            return data;

        })
        .then(function (data) {
            console.log(data);
            Currenttemp.value = Math.floor(data.main.temp - 272);
            highTemp.value = Math.floor(data.main.temp_max - 272);
            lowTemp.value = Math.floor(data.main.temp_min - 272);
            description.value = data.weather[0].description;
            weatherIcon.value = data.weather[0].icon;
            humidity.value = data.main.humidity;
            wind.value = data.wind.speed;
            city.value = data.name;
            weatherReport(data);
        })
        .then(function () {
            displayWeather();
        });
}
function displayWeather() {

    Currenttemp.innerHTML = Currenttemp.value + '<sup>°c</sup>';
    description.innerHTML = description.value;
    city.innerHTML = city.value;
    highTemp.innerHTML = highTemp.value + '<sup>°c</sup>';
    lowTemp.innerHTML = lowTemp.value + '<sup>°c</sup>';
    humidity.innerHTML = humidity.value + '<span>%</span>';
    wind.innerHTML = wind.value + '<span>Km/h</span>';
    weatherIcon.innerHTML = `<img src="assets/img/${weatherIcon.value}.png"/> `;

}

// Forecast API

function weatherReport(data) {

    let apiFForcast = `https://api.openweathermap.org/data/2.5/forecast?q=${data.name}&exclude=hourly,minutely&units=metric&appid=${key}`
    fetch(apiFForcast)
        .then(function (response) {
            let forecast = response.json();
            return forecast;

        })
        .then(function (forecast) {
            dayForecast(forecast)
        })
}


function dayForecast(forecast) {
    document.querySelector('.weekF').innerHTML = ''
    for (let i = 8; i < forecast.list.length; i += 8) {
        console.log(forecast);
        let div = document.createElement('div');
        div.setAttribute('class', 'dayF forcast-box');

        let day = document.createElement('p');
        day.setAttribute('class', 'date')
        day.innerText = new Date(forecast.list[i].dt * 1000).toDateString(undefined, 'Asia/Kolkata');
        div.appendChild(day);

        let temp = document.createElement('p');
        temp.setAttribute('class', 'tempset')
        temp.innerText = Math.floor((forecast.list[i].main.temp_max)) + ' °C' + ' / ' + Math.floor((forecast.list[i].main.temp_min)) + ' °C';
        div.appendChild(temp)

        let description = document.createElement('p');
        description.setAttribute('class', 'desc')
        description.innerText = forecast.list[i].weather[0].description;
        div.appendChild(description);

        document.querySelector('.weekF').appendChild(div)
    }
}
